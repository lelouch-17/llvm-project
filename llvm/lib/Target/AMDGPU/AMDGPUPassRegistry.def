//===- AMDGPUPassRegistry.def - Registry of passes for AMDGPU ---*- C++ -*-===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
// AMDGPU pass registry
//
//===----------------------------------------------------------------------===//

// NOTE: NO INCLUDE GUARD DESIRED!
// Move all passes to dummy table to normal table once they are ported to the 
// new pass manager interface.

#ifndef FUNCTION_PASS
#define FUNCTION_PASS(NAME, PASS_NAME, CONSTRUCTOR)
#endif
FUNCTION_PASS("amdgpu-image-intrinsic-opt", AMDGPUImageIntrinsicOptimizerPass, (getTM<AMDGPUTargetMachine>()))
FUNCTION_PASS("amdgpu-atomic-optimizer", AMDGPUAtomicOptimizerPass, (getTM<AMDGPUTargetMachine>(), ScanOptions::None))
FUNCTION_PASS("amdgpu-promote-alloca", AMDGPUPromoteAllocaPass, (getTM<AMDGPUTargetMachine>()))
FUNCTION_PASS("amdgpu-codegenprepare", AMDGPUCodeGenPreparePass, (getTM<AMDGPUTargetMachine>()))
FUNCTION_PASS("amdgpu-lower-kernel-arguments", AMDGPULowerKernelArgumentsPass, (getTM<AMDGPUTargetMachine>()))
FUNCTION_PASS("amdgpu-rewrite-undef-for-phi", AMDGPURewriteUndefForPHIPass, ())
FUNCTION_PASS("load-store-vectorizer", LoadStoreVectorizerPass, ())
FUNCTION_PASS("lowerswitch", LowerSwitchPass, ())
FUNCTION_PASS("separate-const-offset-from-gep", SeparateConstOffsetFromGEPPass, ())
FUNCTION_PASS("slsr", StraightLineStrengthReducePass, ())
FUNCTION_PASS("nary-reassociate", NaryReassociatePass, ())
FUNCTION_PASS("gvn", GVNPass, ())
FUNCTION_PASS("early-cse", EarlyCSEPass, ())
FUNCTION_PASS("amdgpu-aa", AMDGPUAA, ()) 
#undef FUNCTION_PASS

#ifndef DUMMY_FUNCTION_PASS
#define DUMMY_FUNCTION_PASS(NAME, PASS_NAME, CONSTRUCTOR)
#endif
DUMMY_FUNCTION_PASS("amdgpu-annotate-kernel-features-dummy", AMDGPUAnnotateKernelFeaturesPass, ())
DUMMY_FUNCTION_PASS("amdgpu-annotate-uniform-values-dummy", AMDGPUAnnotateUniformValuesPass, ())
DUMMY_FUNCTION_PASS("si-annotate-control-flow-dummy", SIAnnotateControlFlowPass, ())
DUMMY_FUNCTION_PASS("amdgpu-late-codgen-prepare-dummy", AMDGPULateCodeGenPreparePass, ())
DUMMY_FUNCTION_PASS("si-form-memory-clauses", AMDGPUPerfHintAnalysisPass, ()) // CGSCC Pass
#undef DUMMY_FUNCTION_PASS

#ifndef DUMMY_LOOP_PASS
#define DUMMY_LOOP_PASS(NAME, CREATE_PASS, CONSTRUCTOR)
#endif
DUMMY_LOOP_PASS("licm", LICMPass, ())
#undef DUMMY_LOOP_PASS

#ifndef MODULE_PASS
#define MODULE_PASS(NAME, PASS_NAME, CONSTRUCTOR)
#endif
MODULE_PASS("amdgpu-printf-runtime-binding", AMDGPUPrintfRuntimeBindingPass, ())
MODULE_PASS("amdgpu-always-inline", AMDGPUAlwaysInlinePass, ())
MODULE_PASS("amdgpu-attributor", AMDGPUAttributorPass, (getTM<AMDGPUTargetMachine>()))
MODULE_PASS("amdgpu-lower-module-lds", AMDGPULowerModuleLDSPass, (getTM<AMDGPUTargetMachine>()))

#undef MODULE_PASS

#ifndef DUMMY_MODULE_PASS
#define DUMMY_MODULE_PASS(NAME, PASS_NAME, CONSTRUCTOR)
#endif
DUMMY_MODULE_PASS("amdgpu-ctor-dtor-functions-dummy", AMDGPUCtorDtorLoweringLegacyPass, ())
DUMMY_MODULE_PASS("always-inliner-legacy-dummy", AlwaysInlinerLegacyPass, ())
DUMMY_MODULE_PASS("r600-opencl-image-type-lowering-dummy", R600OpenCLImageTypeLoweringPass, ())
DUMMY_MODULE_PASS("amdgpu-opencl-enqueued-lowering-dummy", AMDGPUOpenCLEnqueuedBlockLoweringPass, ())
DUMMY_MODULE_PASS("amdgpu-lower-module-lds-legacy-dummy", AMDGPULowerModuleLDSLegacyPass, (TargetMachine))
DUMMY_MODULE_PASS("amdgpu-remove-incompatible-functions-dummy", AMDGPURemoveIncompatibleFunctionsPass, ())

#undef DUMMY_MODULE_PASS


#ifndef MACHINE_FUNCTION_PASS
#define MACHINE_FUNCTION_PASS(NAME, PASS_NAME, CONSTRUCTOR)
MACHINE_FUNCTION_PASS("free-machine-function", FreeMachineFunctionPass, ())
#endif

#undef MACHINE_FUNCTION_PASS

// PASS_NAME is for mocking machine passes, remove it after all machine passes
// are added new pass manager interface.
#ifndef DUMMY_MACHINE_FUNCTION_PASS
#define DUMMY_MACHINE_FUNCTION_PASS(NAME, PASS_NAME, CONSTRUCTOR)
#endif
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-isel-dag-dummy", AMDGPUDAGToDAGISelPass, (getTM<AMDGPUTargetMachine>(), getOptLevel()))
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-postlegalizer-combiner-dummy", AMDGPUPostLegalizeCombinerPass, (IsOptNone))
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-prelegalizer-combiner-dummy", AMDGPUPreLegalizerCombinerPass, (getOptLevel()))
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-regbank-comb-dummy", AMDGPURegBankCombinerPass, (IsOptNone))
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-cfg-structurizer-dummy", AMDGPUMachineCFGStructurizerPass, ())
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-insert-single-use-vtsd-dummy", AMDGPUInsertSingleUseVDSTPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-whole-quad-mode-dummy", SIWholeQuadModePass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-fix-sgpr-copies-dummy", SIFixSGPRCopiesPass, ())  //
DUMMY_MACHINE_FUNCTION_PASS("si-lower-i1-copies-dummy", SILowerI1CopiesPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-lower-control-flow-dummy", SILowerControlFlowPass, ())
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-pre-ra-long-branch-reg-dummy", GCNPreRALongBranchRegPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-lower-sgpr-spills-dummy", SILowerSGPRSpillsPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-preallocate-wwm-regs-dummy", SIPreAllocateWWMRegsPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-lower-wwm-copies-dummy", SILowerWWMCopiesPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-fix-vgpr-copies-dummy", SIFixVGPRCopiesPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-postra-bundler-dummy", SIPostRABundlerPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-memory-legalizer-dummy", SIMemoryLegalizerPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-insert-waitcnts-dummy", SIInsertWaitcntsPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-mode-register-dummy", SIModeRegisterPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-set-wave-priority", AMDGPUSetWavePriorityPass, ())
DUMMY_MACHINE_FUNCTION_PASS("branch-relaxation", BranchRelaxationPass, ())
DUMMY_MACHINE_FUNCTION_PASS("post-RA-hazard-recognizer", PostRAHazardRecognizerPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-late-branch-lowering-dummy", SILateBranchLoweringPass, ())
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-asm-printer-dummy", AMDGPUAsmPrinterPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-fold-operands-dummy", SIFoldOperandsPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-load-store-optimizer-dummy", SILoadStoreOptimizerPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-shrink-instructions-dummy", SIShrinkInstructionsPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-optimize-vgpr-live-range-dummy", SIOptimizeVGPRLiveRangePass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-optimize-exec-masking-dummy", SIOptimizeExecMaskingPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-optimize-exec-masking-prera-dummy", SIOptimizeExecMaskingPreRAPass, ())
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-nsa-reassign-dummy", GCNNSAReassignPass, ())
DUMMY_MACHINE_FUNCTION_PASS("gcn-create-vopd-dummy", GCNCreateVOPDPass, ())
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-pre-ra-optimizations-dummy", GCNPreRAOptimizationsPass, ())
DUMMY_MACHINE_FUNCTION_PASS("rewrite-partial-reg-uses-dummy", GCNRewritePartialRegUsesPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-insert-hard-clauses-dummy", SIInsertHardClausesPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-pre-emit-peephole-dummy", SIPreEmitPeepholePass, ())
DUMMY_MACHINE_FUNCTION_PASS("amdgpu-insert-delay-alu-dummy", AMDGPUInsertDelayAluPass, ())
DUMMY_MACHINE_FUNCTION_PASS("gcn-dpp-combine-dummy", GCNDPPCombinePass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-peephole-sdwa-dummy", SIPeepholeSDWAPass, ())
DUMMY_MACHINE_FUNCTION_PASS("si-form-memory-clauses", SIFormMemoryClausesPass, ())


#undef DUMMY_MACHINE_FUNCTION_PASS//===- AMDGPUPassRegistry.def - Registry of AMDGPU passes -------*- C++ -*-===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
// This file is used as the registry of passes that are part of the
// AMDGPU backend.
//
//===----------------------------------------------------------------------===//

// NOTE: NO INCLUDE GUARD DESIRED!

#ifndef MODULE_PASS
#define MODULE_PASS(NAME, CREATE_PASS)
#endif
MODULE_PASS("amdgpu-always-inline", AMDGPUAlwaysInlinePass())
MODULE_PASS("amdgpu-attributor", AMDGPUAttributorPass(*this))
MODULE_PASS("amdgpu-lower-buffer-fat-pointers",
            AMDGPULowerBufferFatPointersPass(*this))
MODULE_PASS("amdgpu-lower-ctor-dtor", AMDGPUCtorDtorLoweringPass())
MODULE_PASS("amdgpu-lower-module-lds", AMDGPULowerModuleLDSPass(*this))
MODULE_PASS("amdgpu-printf-runtime-binding", AMDGPUPrintfRuntimeBindingPass())
MODULE_PASS("amdgpu-unify-metadata", AMDGPUUnifyMetadataPass())
#undef MODULE_PASS

#ifndef FUNCTION_PASS
#define FUNCTION_PASS(NAME, CREATE_PASS)
#endif
FUNCTION_PASS("amdgpu-codegenprepare", AMDGPUCodeGenPreparePass(*this))
FUNCTION_PASS("amdgpu-image-intrinsic-opt",
              AMDGPUImageIntrinsicOptimizerPass(*this))
FUNCTION_PASS("amdgpu-lower-kernel-arguments",
              AMDGPULowerKernelArgumentsPass(*this))
FUNCTION_PASS("amdgpu-lower-kernel-attributes",
              AMDGPULowerKernelAttributesPass())
FUNCTION_PASS("amdgpu-simplifylib", AMDGPUSimplifyLibCallsPass())
FUNCTION_PASS("amdgpu-promote-alloca", AMDGPUPromoteAllocaPass(*this))
FUNCTION_PASS("amdgpu-promote-alloca-to-vector",
              AMDGPUPromoteAllocaToVectorPass(*this))
FUNCTION_PASS("amdgpu-promote-kernel-arguments",
              AMDGPUPromoteKernelArgumentsPass())
FUNCTION_PASS("amdgpu-rewrite-undef-for-phi", AMDGPURewriteUndefForPHIPass())
FUNCTION_PASS("amdgpu-unify-divergent-exit-nodes",
              AMDGPUUnifyDivergentExitNodesPass())
FUNCTION_PASS("amdgpu-usenative", AMDGPUUseNativeCallsPass())
#undef FUNCTION_PASS

#ifndef FUNCTION_ANALYSIS
#define FUNCTION_ANALYSIS(NAME, CREATE_PASS)
#endif

#ifndef FUNCTION_ALIAS_ANALYSIS
#define FUNCTION_ALIAS_ANALYSIS(NAME, CREATE_PASS)                             \
  FUNCTION_ANALYSIS(NAME, CREATE_PASS)
#endif
FUNCTION_ALIAS_ANALYSIS("amdgpu-aa", AMDGPUAA())
#undef FUNCTION_ALIAS_ANALYSIS
#undef FUNCTION_ANALYSIS

#ifndef FUNCTION_PASS_WITH_PARAMS
#define FUNCTION_PASS_WITH_PARAMS(NAME, CLASS, CREATE_PASS, PARSER, PARAMS)
#endif
FUNCTION_PASS_WITH_PARAMS(
    "amdgpu-atomic-optimizer",
    "AMDGPUAtomicOptimizerPass",
    [=](ScanOptions Strategy) {
      return AMDGPUAtomicOptimizerPass(*this, Strategy);
    },
    parseAMDGPUAtomicOptimizerStrategy, "strategy=dpp|iterative|none")
#undef FUNCTION_PASS_WITH_PARAMS
